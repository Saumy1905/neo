---
layout: default
---
<div class="container">
  <!-- Breadcrumbs -->
  <nav class="breadcrumbs">
    <a href="{{ '/' | relative_url }}">Home</a> &gt;
    <a href="{{ '/colleges/' | append: page.college_slug | relative_url }}">{{ page.college_name }}</a> &gt;
    <a href="{{ '/colleges/' | append: page.college_slug | append: '/' | append: page.branch_slug | relative_url }}">{{ page.branch_name }}</a> &gt;
    <a href="{{ '/colleges/' | append: page.college_slug | append: '/' | append: page.branch_slug | append: '/' | append: page.semester_slug | relative_url }}">{{ page.semester_name }}</a> &gt;
    <a href="{{ '/colleges/' | append: page.college_slug | append: '/' | append: page.branch_slug | append: '/' | append: page.semester_slug | append: '/' | append: page.subject_slug | relative_url }}">{{ page.subject_name }}</a> &gt;
    <span>{{ page.title }}</span>
  </nav>

  <!-- PDF Viewer Header -->
  <header class="pdf-viewer-header">
    <h1 class="pdf-title">{{ page.title }} ({{ page.year }})</h1>
    <div class="pdf-meta">
      <span>{{ page.college_name }}</span>
      <span>{{ page.branch_name }}</span>
      <span>{{ page.semester_name }}</span>
      <span>{{ page.pages | default: 'N/A' }} pages</span>
    </div>
  </header>

  <!-- PDF Controls -->
  <div class="pdf-controls">
    <button id="prev-page" class="pdf-btn" disabled>
      <i class="fas fa-chevron-left"></i> Previous
    </button>
    <span id="page-info">Page <span id="current-page">1</span> of <span id="total-pages">--</span></span>
    <button id="next-page" class="pdf-btn" disabled>
      Next <i class="fas fa-chevron-right"></i>
    </button>
    <div class="pdf-zoom-controls">
      <button id="zoom-out" class="pdf-btn">
        <i class="fas fa-search-minus"></i>
      </button>
      <span id="zoom-level">100%</span>
      <button id="zoom-in" class="pdf-btn">
        <i class="fas fa-search-plus"></i>
      </button>
    </div>
  </div>

  <!-- PDF Canvas Container -->
  <div class="pdf-viewer-container" id="pdf-viewer-container">
    <div class="pdf-loading" id="pdf-loading">
      <div class="loading-spinner"></div>
      <p>Loading PDF...</p>
    </div>
    <canvas id="pdf-canvas" class="pdf-canvas"></canvas>
  </div>

  <!-- PDF Actions -->
  <div class="pdf-actions-bar">
    <button id="fullscreen-btn" class="btn-fullscreen">
      <i class="fas fa-expand"></i> Fullscreen
    </button>
    <a href="{{ page.file | relative_url }}" class="btn-download" download>
      <i class="fas fa-download"></i> Download
    </a>
  </div>
</div>

<!-- PDF.js Integration Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const pdfUrl = '{{ page.file | relative_url }}';
  const pdfCanvas = document.getElementById('pdf-canvas');
  const pdfLoading = document.getElementById('pdf-loading');
  const pdfContainer = document.getElementById('pdf-viewer-container');
  
  let pdfDoc = null;
  let currentPage = 1;
  let totalPages = 0;
  let scale = 1.0;
  let renderContext = null;
  
  // Load PDF
  pdfjsLib.getDocument(pdfUrl).promise.then(function(pdf) {
    pdfDoc = pdf;
    totalPages = pdf.numPages;
    
    // Update UI
    document.getElementById('total-pages').textContent = totalPages;
    document.getElementById('current-page').textContent = currentPage;
    
    // Hide loading, show canvas
    pdfLoading.style.display = 'none';
    pdfCanvas.style.display = 'block';
    
    // Enable navigation buttons
    updateNavigationButtons();
    
    // Render first page
    renderPage(currentPage);
    
  }).catch(function(error) {
    console.error('Error loading PDF:', error);
    pdfLoading.innerHTML = '<p>Error loading PDF. Please try downloading instead.</p>';
  });
  
  // Render page function
  function renderPage(pageNum) {
    if (!pdfDoc) return;
    
    pdfDoc.getPage(pageNum).then(function(page) {
      // Calculate scale for mobile responsiveness
      const containerWidth = pdfContainer.clientWidth;
      const viewport = page.getViewport({ scale: 1.0 });
      const mobileScale = Math.min(containerWidth / viewport.width, 1.2);
      scale = window.innerWidth < 768 ? mobileScale : 1.0;
      
      const scaledViewport = page.getViewport({ scale: scale });
      
      // Set canvas dimensions
      pdfCanvas.width = scaledViewport.width;
      pdfCanvas.height = scaledViewport.height;
      
      // Render page
      const renderContext = {
        canvasContext: pdfCanvas.getContext('2d'),
        viewport: scaledViewport
      };
      
      page.render(renderContext);
      
      // Update page info
      document.getElementById('current-page').textContent = pageNum;
      document.getElementById('zoom-level').textContent = Math.round(scale * 100) + '%';
    });
  }
  
  // Navigation functions
  function updateNavigationButtons() {
    document.getElementById('prev-page').disabled = currentPage <= 1;
    document.getElementById('next-page').disabled = currentPage >= totalPages;
  }
  
  // Event listeners
  document.getElementById('prev-page').addEventListener('click', function() {
    if (currentPage > 1) {
      currentPage--;
      renderPage(currentPage);
      updateNavigationButtons();
    }
  });
  
  document.getElementById('next-page').addEventListener('click', function() {
    if (currentPage < totalPages) {
      currentPage++;
      renderPage(currentPage);
      updateNavigationButtons();
    }
  });
  
  document.getElementById('zoom-in').addEventListener('click', function() {
    scale *= 1.2;
    renderPage(currentPage);
    document.getElementById('zoom-level').textContent = Math.round(scale * 100) + '%';
  });
  
  document.getElementById('zoom-out').addEventListener('click', function() {
    scale /= 1.2;
    renderPage(currentPage);
    document.getElementById('zoom-level').textContent = Math.round(scale * 100) + '%';
  });
  
  // Fullscreen functionality
  document.getElementById('fullscreen-btn').addEventListener('click', function() {
    if (pdfContainer.requestFullscreen) {
      pdfContainer.requestFullscreen();
    } else if (pdfContainer.mozRequestFullScreen) {
      pdfContainer.mozRequestFullScreen();
    } else if (pdfContainer.webkitRequestFullscreen) {
      pdfContainer.webkitRequestFullscreen();
    } else if (pdfContainer.msRequestFullscreen) {
      pdfContainer.msRequestFullscreen();
    }
  });
  
  // Touch gestures for mobile
  if ('ontouchstart' in window) {
    let touchStartX = 0;
    let touchStartY = 0;
    
    pdfCanvas.addEventListener('touchstart', function(e) {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    });
    
    pdfCanvas.addEventListener('touchend', function(e) {
      const touchEndX = e.changedTouches[0].clientX;
      const touchEndY = e.changedTouches[0].clientY;
      const deltaX = touchEndX - touchStartX;
      const deltaY = touchEndY - touchStartY;
      
      // Horizontal swipe detection
      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
        if (deltaX > 0 && currentPage > 1) {
          // Swipe right - previous page
          currentPage--;
          renderPage(currentPage);
          updateNavigationButtons();
        } else if (deltaX < 0 && currentPage < totalPages) {
          // Swipe left - next page
          currentPage++;
          renderPage(currentPage);
          updateNavigationButtons();
        }
      }
    });
  }
  
  // Responsive recalculation
  window.addEventListener('resize', function() {
    if (pdfDoc) {
      renderPage(currentPage);
    }
  });
});
</script>
